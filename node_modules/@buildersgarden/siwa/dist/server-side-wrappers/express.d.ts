/**
 * express.ts
 *
 * Server-side wrappers for Express applications.
 *
 * @example
 * ```ts
 * import { siwaMiddleware, siwaJsonParser, siwaCors } from "@buildersgarden/siwa/express";
 *
 * app.use(siwaJsonParser());
 * app.use(siwaCors());
 * app.get('/api/protected', siwaMiddleware(), (req, res) => {
 *   res.json({ agent: req.agent });
 * });
 * ```
 */
import type { RequestHandler } from 'express';
import { type SiwaAgent, type VerifyOptions } from '../erc8128.js';
import { type CaptchaPolicy, type CaptchaOptions } from '../captcha.js';
import type { SignerType } from '../signer/index.js';
import { type X402Config, type X402Payment } from '../x402.js';
export type { SiwaAgent };
declare global {
    namespace Express {
        interface Request {
            agent?: SiwaAgent;
            payment?: X402Payment;
            rawBody?: string;
        }
    }
}
export interface SiwaMiddlewareOptions {
    /** HMAC secret for receipt verification. Defaults to RECEIPT_SECRET or SIWA_SECRET env. */
    receiptSecret?: string;
    /** RPC URL for optional onchain verification. */
    rpcUrl?: string;
    /** Enable onchain ownerOf check. */
    verifyOnchain?: boolean;
    /** Public client for ERC-1271 or onchain checks. */
    publicClient?: VerifyOptions['publicClient'];
    /** Allowed signer types. Omit to accept all. */
    allowedSignerTypes?: SignerType[];
    /** Captcha policy for per-request challenges. */
    captchaPolicy?: CaptchaPolicy;
    /** Captcha options (secret, topics, formats). Secret defaults to receiptSecret. */
    captchaOptions?: CaptchaOptions;
    /** Optional x402 payment gate. When set, both SIWA auth AND a valid payment are required. */
    x402?: X402Config;
}
export interface SiwaCorsOptions {
    /** Allowed origin(s). Defaults to "*". */
    origin?: string;
    /** Allowed HTTP methods. */
    methods?: string;
    /** Allowed headers. */
    headers?: string;
    /** Include x402 payment headers in CORS. */
    x402?: boolean;
}
/**
 * CORS middleware pre-configured with SIWA-specific headers.
 * Handles OPTIONS preflight automatically.
 *
 * When `x402: true` is set, also includes x402 payment headers.
 */
export declare function siwaCors(options?: SiwaCorsOptions): RequestHandler;
/**
 * `express.json()` pre-configured with rawBody capture for Content-Digest verification.
 */
export declare function siwaJsonParser(): RequestHandler;
/**
 * Express middleware that verifies ERC-8128 HTTP Message Signatures + SIWA receipt,
 * with optional x402 payment gate.
 *
 * **Without x402** (SIWA only):
 *   - Valid SIWA headers → `req.agent` → `next()`
 *   - Missing/invalid → 401
 *
 * **With x402** (SIWA + payment):
 *   - SIWA must succeed → otherwise 401
 *   - Payment must also succeed → otherwise 402 with payment requirements
 *   - Both succeed → `req.agent` + `req.payment` → `next()`
 */
export declare function siwaMiddleware(options?: SiwaMiddlewareOptions): RequestHandler;
/**
 * Create a pre-configured `siwaMiddleware` with shared defaults.
 *
 * Use this to apply the same captcha policy and options globally,
 * with optional per-route overrides.
 *
 * @param defaults  Shared options applied to all routes
 * @returns         A `siwaMiddleware`-like function that bakes in the defaults
 *
 * @example
 * ```typescript
 * import { createSiwaMiddleware, siwaJsonParser, siwaCors } from "@buildersgarden/siwa/express";
 *
 * const auth = createSiwaMiddleware({
 *   captchaPolicy: async ({ address }) => {
 *     const known = await db.agents.exists(address);
 *     return known ? null : 'medium';
 *   },
 *   captchaOptions: { secret: process.env.SIWA_SECRET! },
 * });
 *
 * app.use(siwaJsonParser());
 * app.use(siwaCors());
 *
 * // Apply globally
 * app.use(auth());
 *
 * // Or per-route with overrides
 * app.post('/api/transfer', auth({ captchaPolicy: () => 'hard' }), handler);
 * ```
 */
export declare function createSiwaMiddleware(defaults: SiwaMiddlewareOptions): (overrides?: Partial<SiwaMiddlewareOptions>) => RequestHandler;
