/**
 * fastify.ts
 *
 * Server-side wrappers for Fastify applications.
 * Uses preHandler hooks for authentication.
 *
 * @example
 * ```ts
 * import Fastify from "fastify";
 * import { siwaPlugin, siwaAuth } from "@buildersgarden/siwa/fastify";
 *
 * const fastify = Fastify();
 * await fastify.register(siwaPlugin);
 *
 * fastify.post("/api/protected", { preHandler: siwaAuth() }, async (req) => {
 *   return { agent: req.agent };
 * });
 * ```
 */
import type { FastifyPluginAsync, preHandlerHookHandler } from 'fastify';
import { type SiwaAgent, type VerifyOptions } from '../erc8128.js';
import type { SignerType } from '../signer/index.js';
import { type X402Config, type X402Payment } from '../x402.js';
export type { SiwaAgent, X402Payment };
declare module 'fastify' {
    interface FastifyRequest {
        agent?: SiwaAgent;
        payment?: X402Payment;
    }
}
export interface SiwaAuthOptions {
    /** HMAC secret for receipt verification. Defaults to RECEIPT_SECRET or SIWA_SECRET env. */
    receiptSecret?: string;
    /** RPC URL for optional onchain verification. */
    rpcUrl?: string;
    /** Enable onchain ownerOf check. */
    verifyOnchain?: boolean;
    /** Public client for ERC-1271 or onchain checks. */
    publicClient?: VerifyOptions['publicClient'];
    /** Allowed signer types. Omit to accept all. */
    allowedSignerTypes?: SignerType[];
    /** Optional x402 payment gate. When set, both SIWA auth AND a valid payment are required. */
    x402?: X402Config;
}
export interface SiwaPluginOptions {
    /** CORS allowed origin(s). Defaults to true (reflect origin). */
    origin?: boolean | string | string[];
    /** Allowed headers including SIWA-specific ones. */
    allowedHeaders?: string[];
    /** Include x402 payment headers in CORS. */
    x402?: boolean;
}
/**
 * Fastify plugin that sets up CORS with SIWA-specific headers.
 * Requires @fastify/cors to be installed.
 */
export declare const siwaPlugin: FastifyPluginAsync<SiwaPluginOptions>;
/**
 * Fastify preHandler that verifies ERC-8128 HTTP Message Signatures + SIWA receipt.
 *
 * On success, sets `req.agent` with the verified agent identity.
 * When x402 is configured and payment succeeds, also sets `req.payment`.
 * On failure, responds with 401 (auth) or 402 (payment).
 */
export declare function siwaAuth(options?: SiwaAuthOptions): preHandlerHookHandler;
