/**
 * next.ts
 *
 * Server-side wrappers for Next.js App Router route handlers.
 * Uses only web standard APIs (Request, Response, Headers) â€” no `next` dependency needed.
 *
 * @example
 * ```ts
 * import { withSiwa, siwaOptions } from "@buildersgarden/siwa/next";
 *
 * export const POST = withSiwa(async (agent, req) => {
 *   const body = await req.json();
 *   return { received: body, agent: { address: agent.address, agentId: agent.agentId } };
 * });
 *
 * export { siwaOptions as OPTIONS };
 * ```
 */
import { type SiwaAgent } from '../erc8128.js';
import { type CaptchaPolicy, type CaptchaOptions } from '../captcha.js';
import type { SignerType } from '../signer/index.js';
import { type X402Config, type X402Payment } from '../x402.js';
export type { SiwaAgent, X402Payment };
export interface WithSiwaOptions {
    /** HMAC secret for receipt verification. Defaults to RECEIPT_SECRET or SIWA_SECRET env. */
    receiptSecret?: string;
    /** RPC URL for optional onchain verification. */
    rpcUrl?: string;
    /** Enable onchain ownerOf check. */
    verifyOnchain?: boolean;
    /** Allowed signer types. Omit to accept all. */
    allowedSignerTypes?: SignerType[];
    /** Captcha policy for per-request challenges. */
    captchaPolicy?: CaptchaPolicy;
    /** Captcha options (secret, topics, formats). Secret defaults to receiptSecret. */
    captchaOptions?: CaptchaOptions;
    /** Optional x402 payment gate. When set, both SIWA auth AND a valid payment are required. */
    x402?: X402Config;
}
export interface CorsOptions {
    /** Include x402 payment headers in CORS. */
    x402?: boolean;
}
/** CORS headers required by SIWA-authenticated requests. */
export declare function corsHeaders(options?: CorsOptions): Record<string, string>;
/** Return a JSON Response with CORS headers. */
export declare function corsJson(data: unknown, init?: {
    status?: number;
    headers?: Record<string, string>;
}, corsOpts?: CorsOptions): Response;
/** Return a 204 OPTIONS response with CORS headers. */
export declare function siwaOptions(corsOpts?: CorsOptions): Response;
type SiwaHandler = (agent: SiwaAgent, req: Request, payment?: X402Payment) => Promise<Record<string, unknown> | Response> | Record<string, unknown> | Response;
/**
 * Wrap a Next.js route handler with SIWA ERC-8128 authentication.
 *
 * - Clones POST/PUT/PATCH requests so the body is available after verification
 * - Normalizes the request URL for reverse-proxy environments
 * - Returns 401 with CORS headers on auth failure
 * - If the handler returns a plain object, it is auto-wrapped in a JSON Response with CORS headers
 * - When x402 is configured, requires payment after SIWA auth succeeds
 */
export declare function withSiwa(handler: SiwaHandler, options?: WithSiwaOptions): (req: Request) => Promise<Response>;
